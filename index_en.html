<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>Zhenwei Lyu — Personal Homepage</title>
  <meta name="description" content="Personal homepage: About, Research Projects, Weekly Logs, Notes & Reflections." />

  <script>
    // Configure MathJax before loading it
    window.MathJax = {
      tex: {
        inlineMath: [["\\(", "\\)"]],
        displayMath: [["\\[", "\\]"]],
      },
      options: {
        skipHtmlTags: ["script", "noscript", "style", "textarea", "pre", "code"],
      },
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.11/dist/purify.min.js"></script>

  <style>
    :root{
      --bg:#ffffff;
      --card:#ffffff;
      --text:#0f172a;     /* slate-900 */
      --muted:#475569;    /* slate-600 */
      --faint:#64748b;    /* slate-500 */
      --border:#e2e8f0;   /* slate-200 */
      --accent:#2563eb;   /* blue-600 */
      --accent2:#7c3aed;  /* violet-600 */
      --maxw: 980px;
      --radius: 16px;
      --shadow: 0 18px 50px rgba(2,6,23,.10);
      --ring: 0 0 0 4px rgba(37,99,235,.15);
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      --serif: ui-serif, Georgia, "Times New Roman", Times, serif;
      --lh: 1.8;
    }

    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0b1220;
        --card:#0f172a;
        --text:#e5e7eb;
        --muted:#cbd5e1;
        --faint:#94a3b8;
        --border: rgba(148,163,184,.22);
        --shadow: 0 22px 60px rgba(0,0,0,.45);
        --ring: 0 0 0 4px rgba(96,165,250,.18);
      }
    }

    *{ box-sizing:border-box; }
    html{ scroll-behavior:smooth; }
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 50% -10%, rgba(37,99,235,.10), transparent 60%),
        radial-gradient(900px 450px at 100% 0%, rgba(124,58,237,.10), transparent 55%),
        var(--bg);
      line-height: var(--lh);
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    a{ color: var(--accent); text-decoration:none; }
    a:hover{ text-decoration:none; text-underline-offset:.18em; }

    .wrap{
      max-width: var(--maxw);
      margin: 0 auto;
      padding: 6px 18px 72px;
    }

    /* ===== Header (photo, name, icons) ===== */
    .hero{
      text-align:center;
      padding-top: 10px;
    }

    .photo{
      width: 180px;
      height: 180px;
      border-radius: 18px;
      border: 1px solid var(--border);
      overflow: hidden;
      margin: 10px auto 14px;
      background: linear-gradient(135deg, rgba(37,99,235,.18), rgba(124,58,237,.16));
      box-shadow: var(--shadow);
      display:grid;
      place-items:center;
    }
    .photo img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .photo .placeholder{
      color: var(--muted);
      font-size: 13px;
      padding: 10px;
    }

    h1{
      margin: 0;
      font-size: clamp(28px, 3.4vw, 40px);
      letter-spacing: -0.02em;
      color: color-mix(in srgb, var(--accent) 80%, var(--text));
    }
    h1.name {
      color: var(--text);
      font-weight: bold; /* optional: applies to the whole h1 unless overridden */
    }
    /* linked part */
    h1.name .name-link,
    h1.name .name-link:visited {
      color: color-mix(in srgb, var(--accent) 75%, var(--text));   
      text-decoration: none;
      font-weight: normal; /* keep or remove as desired */
    }
    /* on hover / keyboard focus */
    h1.name .name-link:hover,
    h1.name .name-link:focus-visible {
      color: var(--text); /* or var(--accent) */
      text-decoration: none;
    }

    /* non-linked part = not bold */
    h1.name .name-rest {
      font-weight: bold;
      color: color-mix(in srgb, var(--accent) 30%, var(--text) 90%);
    }
    .subname{
      margin-top: 4px;
      color: var(--muted);
      font-weight: 600;
    }

    .icons{
      display:flex;
      gap: 14px;
      justify-content:center;
      flex-wrap:wrap;
      margin: 14px 0 10px;
    }
    .iconlink{
      display:inline-flex;
      align-items:center;
      gap: 10px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: color-mix(in srgb, var(--card) 92%, transparent);
      color: color-mix(in srgb, var(--accent) 75%, var(--text));  
      font-weight: 500;
      transition: transform 140ms ease, border-color 140ms ease, background 140ms ease;
    }
    .iconlink:hover{
      transform: translateY(-1px);
      border-color: color-mix(in srgb, var(--accent) 35%, var(--border));
      background: color-mix(in srgb, var(--accent) 10%, var(--card));
      color: var(--text);
      text-decoration:none;
    }
    .icon{
      width: 18px;
      height: 18px;
      display:inline-block;
      color: currentColor;
    }
    .icon svg{ width:18px; height:18px; display:block; }

    /* ===== Only 3 navigation buttons ===== */
    .nav{
      display:flex;
      justify-content:center;
      gap: 10px;
      flex-wrap:wrap;
      margin: 0px 0 18px; /* Remove top margin */
      position: sticky;
      top: 0;
      z-index: 30;
      padding: 2px 0; /* Reduce vertical padding */
      backdrop-filter: blur(10px);
      background: color-mix(in srgb, var(--bg) 76%, transparent);
      border-bottom: 1px solid var(--border);
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      height: 45px; /* Increase height */
      padding: 0 18px; /* Wider buttons */
      font-size: 1.0rem;    /* Slightly larger text */
      border-radius: 999px;
      border: 1px solid var(--border);
      background: color-mix(in srgb, var(--card) 92%, transparent);
      color: var(--muted);
      font-weight: 700;
      letter-spacing: .01em;
      cursor:pointer;
      user-select:none;
    }
    .btn:hover{
      border-color: color-mix(in srgb, var(--accent) 35%, var(--border));
      background: color-mix(in srgb, var(--accent) 10%, var(--card));
      color: var(--text);
    }
    .btn[aria-current="page"]{
      color: var(--text);
      border-color: color-mix(in srgb, var(--accent) 45%, var(--border));
      box-shadow: var(--ring);
      background: color-mix(in srgb, var(--accent) 10%, var(--card));
    }

    /* ===== Sections (match “academic CV page” feel) ===== */
    .section{
      text-align:left;
      margin: 18px auto 0;
      padding: 0 2px;
    }

    .section h2{
      margin: 0;
      font-size: 22px;
      letter-spacing: -0.02em;
    }
    .rule{
      height: 2px;
      background: color-mix(in srgb, var(--text) 60%, var(--border));
      opacity: .55;
      margin: 10px 0 14px;
    }

    .prose{
      font-family: var(--serif);
      color: var(--text);
      font-size: 16px;
    }
    .prose p{
      margin: 0 0 12px;
      color: var(--text);
    }
    .prose .muted{ color: var(--muted); }

    /* Clickable lists */
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin-bottom: 10px;
    }
    .item{
      border: 1px solid var(--border);
      background: color-mix(in srgb, var(--card) 92%, transparent);
      border-radius: var(--radius);
      padding: 14px 14px;
      box-shadow: 0 1px 0 rgba(2,6,23,.04);
      cursor:pointer;
      transition: transform 140ms ease, border-color 140ms ease, background 140ms ease;
    }
    .item:hover{
      transform: translateY(-1px);
      border-color: color-mix(in srgb, var(--accent) 28%, var(--border));
      background: color-mix(in srgb, var(--accent) 6%, var(--card));
    }
    .item:focus-visible{
      outline:none;
      box-shadow: var(--ring);
      border-color: color-mix(in srgb, var(--accent) 55%, var(--border));
    }
    .item-title{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      margin: 0 0 4px;
      font-weight: 800;
      letter-spacing: -0.01em;
    }
    .item-meta{
      color: var(--faint);
      font-variant-numeric: tabular-nums;
      white-space: nowrap;
      font-weight: 700;
      font-size: 14px;
      margin-top: 2px;
    }
    .item-desc{
      margin: 0;
      color: var(--muted);
      font-size: 15px;
    }
    .hint{
      margin: 10px 0 0;
      color: var(--faint);
      font-size: 13px;
    }

    /* Modal */
    .modal{
      position: fixed;
      inset: 0;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 100;
    }
    .modal[aria-hidden="false"]{ display:flex; }
    .overlay{
      position: absolute;
      inset: 0;
      background: rgba(2,6,23,.52);
      z-index: 0;
    }

    /* ===== Figures inside modal ===== */
    .figure-grid{
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin: 12px 0 6px;
    }
    
    .figure{
      margin: 0;
      border: 1px solid var(--border);
      border-radius: 14px;
      overflow: hidden;
      background: color-mix(in srgb, var(--card) 92%, transparent);
    
     /* Side-by-side: left image, right caption */
      display: flex;
      gap: 12px;
      align-items: center;
      padding: 12px;
    }
    
    /* The link is ONLY the image area */                                  
    .figure-link{
      flex: 0 0 60%;
      width: 60%;
      display: block;
      text-decoration: none; /* prevent underline */
    }
    
    /* extra safety if you have a global a:hover underline rule */
    .figure-link:hover,
    .figure-link:focus,
    .figure-link:focus-visible{
      text-decoration: none;
    }
    
    .figure-link img{
      width: 100%;
      height: auto;
      display: block;
      border-radius: 10px;
    }

    /* caption takes remaining space on the right */
    .figure figcaption{
      flex: 1 1 auto;
      padding: 0;            /* padding is on the <a> now */
      font-family: var(--serif);
      color: var(--muted);
      font-size: 18px;
      line-height: 1.6;
    }
    /* Mobile: stack vertically */
    @media (max-width: 720px){
      .figure a{
        flex-direction: column;
      }
      .figure img{
        flex: none;
        width: 100%;
      }
    }

    @media (prefers-color-scheme: dark){
      .overlay{ background: rgba(0,0,0,.62); }
    }

    .entry-link:link{
      color: color-mix(in srgb, var(--accent) 75%, var(--text)); }  /* normal */
    .entry-link:hover{
      color: var(--text); text-decoration: none; }
    .entry-link:focus-visible{
      outline: 2px solid currentColor; outline-offset: 2px; }

    /* caption below the figure */
    .figure--below{ flex-direction: column; align-items: center; }
    .figure--below .figure-link{ width: 90%; flex: none; }

    .dialog{
      position:relative;
      width: min(860px, 100%);
      max-height: min(80vh, 760px);
      overflow:auto;
      border-radius: 18px;
      border: 1px solid var(--border);
      background: var(--card);
      box-shadow: 0 30px 80px rgba(0,0,0,.35);
      padding: 18px 18px 14px;
    }

    .dialog-header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 14px;
      margin-bottom: 8px;
    }
    .dialog h3{
      margin: 0;
      font-size: 20px;
      letter-spacing: -0.02em;
    }
    .dialog .subtitle{
      margin: 3px 0 0;
      color: var(--faint);
      font-size: 13px;
      font-weight: 700;
    }
    .close{
      border: 1px solid var(--border);
      background: color-mix(in srgb, var(--card) 92%, transparent);
      color: var(--muted);
      border-radius: 999px;
      height: 38px;
      padding: 0 12px;
      cursor:pointer;
      font-weight: 800;
    }
    .close:hover{
      border-color: color-mix(in srgb, var(--accent) 35%, var(--border));
      background: color-mix(in srgb, var(--accent) 10%, var(--card));
      color: var(--text);
    }

    .dialog .content{
      margin-top: 10px;
      color: var(--muted);
      font-family: var(--sans);
    }
    .dialog .content p{ margin: 0 0 10px; }
    /* NEW: horizontal line above the "Details" heading in the modal */
    .dialog .content .details-heading{
      margin: 0 0 10px;              /* keep same spacing as other <p> */
      padding-top: 12px;             /* gap between line and the word "Details" */
      border-top: 3px solid var(--border);
    }

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap: 8px;
      margin: 10px 0 0;
    }
    .chip{
      font-family: var(--sans);
      font-size: 12px;
      font-weight: 700;
      color: var(--muted);
      border: 1px solid var(--border);
      padding: 4px 10px;
      border-radius: 999px;
      background: color-mix(in srgb, var(--card) 92%, transparent);
    }

    footer{
      text-align:center;
      margin-top: 26px;
      color: var(--faint);
      font-size: 13px;
    }

    @media (max-width: 720px){
      .photo{ width: 150px; height: 150px; border-radius: 16px; }
      .iconlink{ padding: 7px 10px; }
      .btn{ height: 38px; padding: 0 12px; }
      .item{ padding: 12px; }
      .item-meta{ white-space: normal; text-align:right; }
    }

    /* SR-only */
    .sr-only{
      position:absolute; width:1px; height:1px; padding:0; margin:-1px;
      overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }
  </style>
</head>

<body>
  <main class="wrap">

    <!-- 4 buttons: About, Research Projects, Weekly Logs, Notes -->
    <nav class="nav" aria-label="Sections">
      <button class="btn" data-jump="#about" aria-current="page">About</button>
      <button class="btn" data-jump="#projects">Research Projects</button>
      <button class="btn" data-jump="#logs">Weekly Logs</button>
      <button class="btn" data-jump="#notes">Notes</button>
    </nav>
   

    <!-- Header -->
    <header class="hero" id="top">
      <div class="photo" aria-label="Profile photo">
        <!-- Put profile.jpg next to this HTML file, or change src -->
        <img
          src="data/images/avatar.jpg"
          alt="Profile photo"
          onerror="this.remove(); this.parentElement.innerHTML='<div class=&quot;placeholder&quot;>Place <code>profile.jpg</code> next to this HTML file<br>or update the <code>src</code> in the HTML.</div>';"/>
      </div>

      <h1 class="name">
        <span class="name-rest">Zhenwei Lyu</span>                                                                               
        <a class="name-link" href="index.html" lang="zh">(吕振伟)</a>
      </h1>      
      <div class="subname">Dalian University of Technology · Assistant Professor · Gravitational Waves </div>

      <!-- Icons: ONLY three (Email, Github, INSPIRE) -->
      <div class="icons" aria-label="Links">
        <!-- <a class="iconlink" href="mailto:zwlyu@dlut.edu.cn?subject=Hello%20Your%20Name" aria-label="Email">
          <span class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 4h16v16H4z"></path>
              <path d="m22 6-10 7L2 6"></path>
            </svg>
          </span>
          Email
        </a> -->

        <a class="iconlink" href="https://faculty.dlut.edu.cn/lyu/zh_CN/index.htm" target="_blank" rel="noreferrer" aria-label="University Homepage">
          <span class="icon" aria-hidden="true">
            <!-- Simple 'building' icon for university -->
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 22V10l9-7 9 7v12" />
              <path d="M9 22V12h6v10" />
              <path d="M9 12L3 10" />
              <path d="M21 10l-6 2" />
            </svg>
          </span>
          DUT
        </a>
        
        <a class="iconlink" href="https://github.com/gwlyu" target="_blank" rel="noreferrer" aria-label="GitHub">
          <span class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>     
            </svg>
          </span>
          GitHub
        </a>

        <a class="iconlink" href="https://scholar.google.com/citations?user=cZ-D404AAAAJ&hl=en" target="_blank" rel="noreferrer" aria-label="Google Scholar">
          <span class="icon" aria-hidden="true">
            <!-- Graduation cap icon for Google Scholar -->
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 12l-10-5-10 5 10 5 10-5z"></path>
              <path d="M4 15v4c0 .55.45 1 1 1h3"></path>
              <path d="M20 15v4c0 .55-.45 1-1 1h-3"></path>
            </svg>
          </span>
          Google Scholar
        </a>

        <a class="iconlink" href="https://inspirehep.net/authors/1916556?ui-citation-summary=true" target="_blank" rel="noreferrer" aria-label="INSPIRE">
          <span class="icon" aria-hidden="true">
            <!-- simple “book/open” icon for INSPIRE -->
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
              <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
            </svg>
          </span>
          INSPIRE
        </a>
      </div>
    </header>



    <!-- 4 buttons: About, Research Projects, Weekly Logs, Notes -->
    <!--<nav class="nav" aria-label="Sections">
      <button class="btn" data-jump="#about" aria-current="page">About</button>
      <button class="btn" data-jump="#projects">Research Projects</button>
      <button class="btn" data-jump="#logs">Weekly Logs</button>
      <button class="btn" data-jump="#notes">Notes</button>
    </nav>
    -->
   

    <!-- About -->
    <section class="section" id="about" aria-label="About">
      <h2>About</h2>
      <div class="rule"></div>
      <div class="prose">
        <p>
         My research centers on the analysis of gravitational waves, utilizing advanced techniques in waveform modeling and parameter estimation to extract and interpret the complex physical information embedded within these signals.
        </p>
        <p class="muted">
         <!-- I’m currently focusing on efficient training and evaluation. -->
        </p>
      </div>

      <div class="grid" id="aboutList" aria-label="About list"></div>
      <!-- <p class="hint">Tip: Click an item to view details.</p> -->
    </section>


    <!-- Research Projects (clickable -> modal) -->
    <section class="section" id="projects" aria-label="Research Projects">
      <h2>Research Projects</h2>
      <div class="rule"></div>

      <div class="grid" id="projectsList" aria-label="Project list"></div>
      <!-- <p class="hint">Tip: Click a project to view details.</p> -->
    </section>

    <!-- Weekly Logs (clickable -> modal) -->
    <section class="section" id="logs" aria-label="Weekly Logs">
      <h2>Weekly Logs</h2>
      <div class="rule"></div>

      <div class="grid" id="logsList" aria-label="Weekly log list"></div>
      <!-- <p class="hint">Tip: Click a week to view details.</p> -->
    </section>

    <!-- Notes & Reflections (clickable -> modal) -->
    <section class="section" id="notes" aria-label="Notes & Reflections">
      <h2>Notes & Reflections</h2>
      <div class="rule"></div>

      <div class="grid" id="notesList" aria-label="Notes list"></div>
      <!-- <p class="hint">Tip: Click a note to view details.</p> -->
    </section>

    <footer>
      © <span id="year"></span> Zhenwei Lyu · Built with plain HTML/CSS/JS                                                       
    </footer>
  </main>

  <!-- Modal (shared across all sections) -->
  <div class="modal" id="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="overlay" id="overlay"></div>
    <div class="dialog" role="document">
      <div class="dialog-header">
        <div>
          <h3 id="modalTitle">Title</h3>
          <div class="subtitle" id="modalSubtitle">Subtitle</div>
        </div>
        <button class="close" id="closeBtn" type="button">Close</button>
      </div>

      <div class="content" id="modalBody"></div>
      <div class="chips" id="modalChips" aria-label="Tags"></div>

      <div class="sr-only" id="modalHelp">
        Press Escape to close.
      </div>
    </div>
  </div>




  <!-- Include your data files -->
  <script src="data/projects.js"></script>
  <!-- many weekly files -->
  <script src="data/logs/2026.js"></script>
  <script src="data/logs/2025.js" charset="utf-8"></script>                                                                                                             
  <script src="data/notes/2026.js"></script>                                                                                                                                                                                                                  



  <script>
    // ====== Edit your content here ======
    const ABOUT = [
      {
        title: "Employment",
        meta: "2022 — Present",
        details: [
          "Assistant Professor, Dalian University of Technology, 2024-Present",
          "Boya Postdoctoral Fellow, Peking University,  2022-2024",
        ],
      },
      {
        title: "Education",
        meta: "2011 — 2022",
        details: [
          " Ph.D. in Gravitational Physics, University of Guelph, 2018-2022",
          " M. Sc. in Astrophysics, Beijing Normal University, 2015-2018",
          " B. Sc. in Physics, Harbin Institute of Technology, 2011-2015"
        ],
      }
    ];
    // ====== End editable content ======


    // Footer year
    document.getElementById("year").textContent = new Date().getFullYear();

    // Render lists
    const aboutList = document.getElementById("aboutList");
    const projectsList = document.getElementById("projectsList");
    const logsList = document.getElementById("logsList");
    const notesList = document.getElementById("notesList");

    function makeItemCard(entry, kind){
      const div = document.createElement("div");
      div.className = "item";
      div.tabIndex = 0;
      div.setAttribute("role", "button");
      div.setAttribute("aria-label", `Open ${kind} details: ${entry.title}`);

      div.innerHTML = `
        <div class="item-title">
          <span>${escapeHtml(entry.title)}</span>
          <span class="item-meta">${escapeHtml(entry.meta || "")}</span>
        </div>
        <p class="item-desc">${escapeHtml(entry.summary || "")}</p>
      `;

      const open = () => openModal(entry, kind);

      div.addEventListener("click", (e) => {
        // If user clicked a link (or button/input/etc), let it behave normally
        const interactive = e.target.closest("a, button, input, textarea, select, summary, [role='button']");
        if (interactive && interactive !== div) return;

        open();
      });

      div.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          // Only trigger when the card itself is the active element
          if (document.activeElement !== div) return;
          e.preventDefault();
          open();
        }
      });

      return div;
    }

    
    function renderFigures(figures){
      if (!Array.isArray(figures) || figures.length === 0) return "";
    
      const items = figures
        .map(f => renderFigure(f))
        .filter(Boolean)
        .join("");
    
      return items ? `<div class="figure-grid">${items}</div>` : "";
    }
    
    function renderFigure(f){
      const src = escapeAttr(f?.src || "");
      if (!src) return "";
    
      const alt = escapeHtml(f?.alt || "");
    
      // Caption (text). If you want links, consider adding f.captionHtml (trusted) instead.
      const captionText = f?.caption ? escapeHtml(f.caption) : "";
      const caption = captionText ? `<figcaption>${captionText}</figcaption>` : "";
    
      const layout = (f?.layout || "right").toLowerCase();
      if (layout === "below") return renderFigureCaptionBelow({ src, alt, caption });
      return renderFigureCaptionRight({ src, alt, caption }); // default
    }
    
    function renderFigureCaptionRight({ src, alt, caption }){
      return `
        <figure class="figure figure--right">
          <a class="figure-link" href="${src}" target="_blank" rel="noopener noreferrer">
            <img src="${src}" alt="${alt}" loading="lazy">
          </a>
          ${caption}
        </figure>
      `;
    }
    
    function renderFigureCaptionBelow({ src, alt, caption }){
      return `
        <figure class="figure figure--below">
          <a class="figure-link" href="${src}" target="_blank" rel="noopener noreferrer">
            <img src="${src}" alt="${alt}" loading="lazy">
          </a>
          ${caption}
        </figure>
      `;
    }

    function typesetLatex(root = document.body) {
      if (window.MathJax && MathJax.typesetPromise) {
        return MathJax.typesetPromise([root]);
      }
      return Promise.resolve();
    }

    function mdInlineToSafeHtml(md) {
      const html = marked.parseInline(md ?? "");
      return DOMPurify.sanitize(html, {
        // optional hardening:
        USE_PROFILES: { html: true },
      });
    }
    function protectMathDelimiters(md) {
      return (md ?? "")
        .replace(/\\\(/g, "\\\\(")
        .replace(/\\\)/g, "\\\\)")
        .replace(/\\\[/g, "\\\\[")
        .replace(/\\\]/g, "\\\\]");
    }

    function mdBlockToSafeHtml(md) {
      const protectedMd = protectMathDelimiters(md);
      const html = marked.parse(protectedMd);
      return DOMPurify.sanitize(html, { USE_PROFILES: { html: true } });
    }


    ABOUT.forEach(a => aboutList.appendChild(makeItemCard(a, "about")));
    PROJECTS.forEach(p => projectsList.appendChild(makeItemCard(p, "project")));
    WEEKLY_LOGS.forEach(w => logsList.appendChild(makeItemCard(w, "weekly log")));
    NOTES.forEach(n => notesList.appendChild(makeItemCard(n, "note")));

    // Navigation: buttons
    const navButtons = Array.from(document.querySelectorAll(".btn[data-jump]"));
    navButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const target = document.querySelector(btn.getAttribute("data-jump"));
        if (target) target.scrollIntoView({ behavior: "smooth", block: "start" });
      });
    });

    // Active button on scroll
    const sections = ["#about", "#projects", "#logs", "#note"].map(sel => document.querySelector(sel));
    const setActive = (id) => {
      navButtons.forEach(b => {
        const isActive = b.getAttribute("data-jump") === "#" + id;
        if (isActive) b.setAttribute("aria-current", "page");
        else b.removeAttribute("aria-current");
      });
    };
    const obs = new IntersectionObserver((entries) => {
      const top = entries
        .filter(e => e.isIntersecting)
        .sort((a,b) => b.intersectionRatio - a.intersectionRatio)[0];
      if (top) setActive(top.target.id);
    }, { rootMargin: "-15% 0px -70% 0px", threshold: [0.12, 0.2, 0.35, 0.5] });
    sections.filter(Boolean).forEach(s => obs.observe(s));

    // Modal logic
    const modal = document.getElementById("modal");
    const overlay = document.getElementById("overlay");
    const closeBtn = document.getElementById("closeBtn");
    const modalTitle = document.getElementById("modalTitle");
    const modalSubtitle = document.getElementById("modalSubtitle");
    const modalBody = document.getElementById("modalBody");
    const modalChips = document.getElementById("modalChips");

    let lastFocus = null;

    function openModal(entry, kind){
      lastFocus = document.activeElement;

      modalTitle.textContent = entry.title || (
        kind === "about" ? "" :                                                                                                  
        kind === "project" ? "Research Project" :
        kind === "weekly log" ? "Weekly Log" :
        kind === "note" ? "Reflection Note" : ""
      );
      modalSubtitle.textContent = (entry.meta ? entry.meta + " · " : "") + (
        kind === "about" ? "" :
        kind === "project" ? "Research Project" :
        kind === "weekly log" ? "Weekly Log" :
        kind === "note" ? "Reflection Note" : ""
      );

      // Body
      const parts = [];

      // (Optional but recommended) always show summary first if present
      if (entry.summary) {
        parts.push(`<p class="details-heading"><strong>Summary:</strong></p>`);                       
        //parts.push(`<p>${escapeHtml(entry.summary)}</p>`);
        parts.push(`<div class="md">${mdBlockToSafeHtml(entry.summary)}</div>`);
      }
      // NEW: figures block
      parts.push(renderFigures(entry.figures));

      const detailsMd =
        Array.isArray(entry.details_md)
          ? entry.details_md.join("\n\n")  // blank line between blocks
          : entry.details_md;
      // Details (FULL markdown)
      if (detailsMd && detailsMd.trim()) {
        parts.push(`<p class="details-heading"><strong>Details:</strong></p>`);                                                                        
        parts.push(`<div class="md">${mdBlockToSafeHtml(detailsMd)}</div>`);
      } else if (Array.isArray(entry.details) && entry.details.length) {
        // Fallback: old array-of-lines
        parts.push(`<p class="details-heading"><strong>Details</strong></p>`);
        parts.push("<ul class='details-list md'>");
        for (const line of entry.details) parts.push(`<li>${mdInlineToSafeHtml(line)}</li>`);
        parts.push("</ul>");
      } 





      if (Array.isArray(entry.links) && entry.links.length){
        parts.push(`<p><strong>Links</strong></p>`);
        parts.push("<ul>");
        for (const l of entry.links){
          parts.push(`<li><a class="entry-link" href="${escapeAttr(l.href)}" target="_blank" rel="noreferrer">${escapeHtml(l.label)}</a></li>`);
        }
        parts.push("</ul>");
      }

      modalBody.innerHTML = parts.join("");

      // Render LaTeX inside the newly injected modal content
      if (window.MathJax?.typesetClear) MathJax.typesetClear([modalBody]);
      typesetLatex(modalBody);                                                                                                      

      // Tags
      modalChips.innerHTML = "";
      (entry.tags || []).forEach(t => {
        const span = document.createElement("span");
        span.className = "chip";
        span.textContent = t;
        modalChips.appendChild(span);
      });

      modal.setAttribute("aria-hidden", "false");
      document.body.style.overflow = "hidden";
      closeBtn.focus();
    }

    function closeModal(){
      modal.setAttribute("aria-hidden", "true");
      document.body.style.overflow = "";
      if (lastFocus && typeof lastFocus.focus === "function") lastFocus.focus();
    }

    overlay.addEventListener("click", closeModal);
    closeBtn.addEventListener("click", closeModal);
    document.addEventListener("keydown", (e) => {
      if (modal.getAttribute("aria-hidden") === "false" && e.key === "Escape") closeModal();
    });

    // Minimal focus trap
    modal.addEventListener("keydown", (e) => {
      if (modal.getAttribute("aria-hidden") !== "false") return;
      if (e.key !== "Tab") return;

      const focusables = modal.querySelectorAll('button, a[href], [tabindex]:not([tabindex="-1"])');
      const list = Array.from(focusables).filter(el => !el.hasAttribute("disabled"));
      if (!list.length) return;

      const first = list[0];
      const last = list[list.length - 1];

      if (e.shiftKey && document.activeElement === first){
        e.preventDefault();
        last.focus();
      } else if (!e.shiftKey && document.activeElement === last){
        e.preventDefault();
        first.focus();
      }
    });

    // Helpers (avoid injecting HTML)
    function escapeHtml(s){
      return String(s ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#39;");
    }
    function escapeAttr(s){
      // for href; still not a sanitizer, but prevents quote-breaking
      return escapeHtml(s).replaceAll("\n", "").replaceAll("\r", "");
    }
  </script>
</body>
</html>


